#!/bin/bash

ensure_gcloud_config() {
  local config_name="$1"
  local project="${2:-}"
  local account="${3:-}"
  local region="${4:-}"
  local zone="${5:-}"

  if [[ -z "$config_name" ]]; then
    echo "Usage: ensure_gcloud_config <config_name> [project] [account] [region] [zone]" >&2
    return 1
  fi

  if ! gcloud config configurations list --format="value(name)" | grep -qx "$config_name"; then
    echo "Creating gcloud configuration: $config_name"
    gcloud config configurations create "$config_name"
  else
    echo "Configuration '$config_name' already exists."
  fi

  echo "Activating configuration: $config_name"
  gcloud config configurations activate "$config_name"

  # Set properties if provided
  [[ -n "$project" ]] && gcloud config set project "$project"
  [[ -n "$account" ]] && gcloud config set account "$account"
  [[ -n "$region" ]] && gcloud config set compute/region "$region"
  [[ -n "$zone" ]] && gcloud config set compute/zone "$zone"
}
